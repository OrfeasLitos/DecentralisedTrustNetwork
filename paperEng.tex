\documentclass[11pt]{article}
\usepackage[a4paper,top=2cm,bottom=2cm,left=1.5cm,right=1.5cm]{geometry}
\usepackage{graphicx}
\usepackage[linesnumbered,ruled,noend]{algorithm2e}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{amssymb}
\usepackage{fancyvrb}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{hyperref}
\usepackage{courier}
\usepackage{listings}

\newtheorem{theorem}{Theorem}[section]
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]
\theoremstyle{corollary}
\newtheorem{corollary}{Corollary}[section]

\lstset{frame=tb,
%  language=Java,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3
}

% PDF bookmarks
\usepackage{color,hyperref}
\definecolor{darkblue}{rgb}{0.0,0.0,0.3}
\hypersetup{colorlinks,breaklinks,
    linkcolor=darkblue,urlcolor=darkblue,
    anchorcolor=darkblue,citecolor=darkblue}

\pagestyle{fancy}{ %
    \fancyhf{} % remove everything
        \renewcommand{\headrulewidth}{0pt} % remove lines as well
        \renewcommand{\footrulewidth}{0.5pt}
        \rhead{\leftmark}
        \lhead{Decentralized financial reputation with multisig for lines-of-credit}
        \rfoot{Page \thepage\ of \pageref{LastPage}}}
        
\begin{document}

  \section{Abstract}
  Reputation in centralized systems typically uses stars and review-based
  trust. These systems require extensive manual intervention and secrecy to
  avoid manipulation. In decentralized systems this luxury is not available
  as the reputation system should be autonomous and open source. Previous
  peer-to-peer reputation systems define trust abstractly and do not allow for
  financial arguments pertaining to reputation. We propose a concrete
  sybil-resilient decentralized reputation system in which direct trust is
  defined as lines-of-credit using bitcoin's 1-of-2 multisig. We introduce a new
  model for bitcoin wallets in which user coins are split among trusted friends.
  Indirect trust is subsequently defined using a transitive property. This
  enables formal game theoretic arguments pertaining to risk analysis. Using our
  reputation model, we prove that risk and max flows are equivalent and propose
  several algorithms for the redistribution of trust so that a decision can be
  made on whether an anonymous third party can be indirectly trusted. In such a
  setting, the risk incurred by making a purchase from an anonymous vendor
  remains invariant. Finally, we prove the correctness of our algorithms and
  provide optimality arguments for various norms.

  \section{Introduction}

  \section{Tags/Keywords}
      decentralized, trust, web-of-trust, bitcoin, multisig, line-of-credit, trust-as-risk, flow  

  \section{Related Work}

  \section{Key points}

  \section{Definitions}
      \begin{definition}[Players] \ \\
         The set $\mathcal{M} = V(G)$ is the set of all players in the network, otherwise understood as the set of all
         pseudonymous identities.
      \end{definition}
      \begin{definition}[(In/Out) Neighbourhood of $A$, $N^{+}(A), N^{-}(A), N(A)$] \ 
         \begin{enumerate}
            \item Let $N^{+}(A)$ be the set of players $B$ that $A$ directly trusts with any positive value. More
               formally, $N^{+}(A) = \{B \in \mathcal{M} : DTr_{A \rightarrow B} > 0\}$. $N^{+}(A)$ is called out
               neighbourhood of $A$.
            \item Let $N^{-}(A)$ be the set of players $B$ that directly trust $A$ with any positive value. More
               formally, $N^{-}(A) = \{B \in \mathcal{M} : DTr_{B \rightarrow A} > 0\}$. $N^{-}(A)$ is called in
               neighbourhood of $A$.
            \item Let $N(A)$ be the set of players $B$ that either directly trust or are directly trusted by $A$ with
               any positive value. More formally, $N(A) = N^{+}(A) \cup N^{-}(A)$. $N(A)$ is called
               neighbourhood of $A$.
            \item Let $N(A)_i$ (respectively $N^{+}(A)_i, N^{-}(A)_i$) be the $i$-th element of set $N(A)$
               (respectively of $N^{+}(A), N^{-}(A)$), according to an arbitrary but constant enumeration of
               the set players.
         \end{enumerate}
      \end{definition}
      \begin{definition}[Direct Trust from $A$ to $B$, $DTr_{A \rightarrow B}$] \ \\
         Total amount of value that exists in 1-of-$A$,$B$ multisigs in the utxo, where the money is deposited by $A$.
      \end{definition}
      \begin{definition}[Capital of $A$, $Cap_A$] \ \\
         Total amount of value that exists in the utxo and can be spent by $A$.
      \end{definition}
      \begin{definition}[$B$ steals $x$ from $A$] \ \\
         $B$ steals value $x$ from $A$ when $B$ reduces the $DTr_{A \rightarrow B}$ by $x$ and increases $Cap_B$ by $x$.
         This makes sense when $x \leq DTr_{A \rightarrow B}$.
      \end{definition}
      \begin{definition}[Indirect trust from $A$ to $B$ $Tr_{A \rightarrow B}$] \ \\
         Value that $A$ will lose if $B$ steals the maximum amount she can steal (all her incoming trust) and everyone
         else follows the honest strategy.
      \end{definition}
      \begin{definition}[Trust Reduction] \ \\
         Let $A, B \in \mathcal{M}, x_i$ flow to $N^{+}(A)_i$ resulting from $maxFlow(A,B), u_i$ current
         $DTr_{A \rightarrow N^{+}(A)_i}, \\ u_i'$ new $DTr_{A \rightarrow N^{+}(A)_i}, i \in \{1,...,|N^{+}(A)|\}$.
         \begin{enumerate}
            \item The Trust Reduction on neighbour $i, \delta_i$ is defined as $\delta_i = u_i - u_i'$.
            \item The Flow Reduction on neigbour $i, \Delta_i$ is defined as $\Delta_i = x_i - u_i'$.
         \end{enumerate}
         We will also use the standard notation for 1-norm and $\infty$-norm, that is:
         \begin{enumerate}
            \item $||\delta_i||_1 = \sum\limits_{i \in N^{+}(A)}\delta_i$
            \item $||\delta_i||_\infty = \max\limits_{i \in N^{+}(A)}\delta_i$.
         \end{enumerate}
      \end{definition}
      \begin{definition}[Restricted Flow] \ \\
         Let $A, B \in \mathcal{M}, i \in \{1,...,|N^{+}(A)|\}$.
         \begin{enumerate}
            \item Let $F_{A_i \rightarrow B}$ be the flow from $A$ to $N^{+}(A)_i$ as calculated by the $maxFlow(A,B)$
               ($x_i'$) when $u_i' = u_i,$ \\ $u_j' = 0 \:\forall j \in \{1,...,|N^{+}(A)|\} \wedge j \neq i$.
            \item Let $S \subset N^{+}(A)$. Let $F_{A_S \rightarrow B}$ be the sum of flows from $A$ to $S$ as
               calculated by the $maxFlow(A,B)$ ($\sum\limits_{i=1}^{|S|}x_i'$) when $u_C' = u_C \: \forall C \in S,
               u_D' = 0 \: \forall D \in N^{+}(A) \setminus S$.
         \end{enumerate}
      \end{definition}
      \begin{definition}[Turns] \ \\
         The game we are describing is turn-based. In each turn $i$ exactly one player $A \in \mathcal{M}$ chooses
         an action (according to a certain strategy or at random) that can be one of the following, or a finite
         combination thereof:
         \begin{enumerate}
            \item Do nothing (Pass).
            \item Steal value $y_B, 0 \leq y_B \leq DTr_{B \rightarrow A, i-1}$ from $B \in N^{-}(A)$.
            $DTr_{B \rightarrow A, i} = DTr_{B \rightarrow A, i-1} - y_B$.
            \item Add value $y_B, -DTr_{A \rightarrow B, i-1} \leq y_B$ to $B \in N^{+}(A)$.
            $DTr_{A \rightarrow B, i} = DTr_{A \rightarrow B, i-1} + y_B$. When $y_B < 0$, we say that $A$ reduces
            her trust to $B$ by $-y_B$, when $y_B > 0$, we say that $A$ increases her trust to $B$ by $y_B$.
            \item Add value $y_B$ to $B \in \mathcal{M} \setminus N^{+}(A)$.
            Obviously $DTr_{A \rightarrow B, i-1} = 0, DTr_{A \rightarrow B, i} = y_B$. We say that $A$ starts directly
            trusting player $B$ by $y_B$.
         \end{enumerate}
         Player $A$ is not allowed to choose two actions of the same kind against the same player in the same turn.
         For example, $A$ cannot steal $y_{B,1} \leq DTr_{B \rightarrow A, i-1}$ and
         $y_{B,2} \leq DTr_{B \rightarrow A, i-1}$ from $B \in N^{-}(A)$ in the same turn, but can instead steal
         $y_{B,1} + y_{B,2}$ given that $y_{B,1} + y_{B,2} \leq DTr_{B \rightarrow A, i-1}$. Also $A$ is allowed
         to steal $y_B \leq DTr_{B \rightarrow A, i-1}$ from $B$ and start directly trusting the same player $B$ by
         $w_B$ given that $B \in N^{-}(A) \wedge B \notin N^{+}(A)$.
      \end{definition}
      \begin{definition}[Honest strategy] \ \\
         A player $A$ is said to follow the honest strategy if for any value $x$ that has been stolen from her since
         the previous turn she played, she substitutes it in her turn by stealing from others that trust her value
         equal to $min(x,\sum\limits_{B \in \mathcal{M}}{DTr_{B \rightarrow A}})$ and she takes no other action.
      \end{definition}
      \begin{definition}[Idle strategy] \ \\
         A player $A$ is said to follow the idle strategy if she passes in her turn.
      \end{definition}
      \begin{definition}[Evil strategy] \ \\
         A player $A$ is said to follow the evil strategy if she steals value $y_B = DTr_{B \rightarrow A, i-1} \:
         \forall \: B \in N^{-}(A)$ (steals all incoming direct trust) and reduces her trust to $C$ by
         $DTr_{A \rightarrow C, i-1} \: \forall \: C \in N^{+}(A)$ (nullifies her outgoing direct trust) in her turn.
      \end{definition}
  \section{Theorems-Algorithms}
    \begin{theorem}[Saturation theorem] \ \\ 
    \label{saturation}
       Let $s$ source, $n = |N^{+}(s)|, x_i, i \in \{1,...,n\}$, flows to $s$'s neighbours as calculated by the
       maxFlow algorithm, $u_i'$ new direct trusts to the $n$ neighbours and $x_i'$ new flows to the neighbours
       as calculated by the maxFlow algorithm with the new direct trusts, $u_i'$. It holds that
       $\forall i \in \{1,...,n\}, u_i' \leq x_i \Rightarrow x_i' = u_i'$.
    \end{theorem}
    \begin{proof} \ 
       \begin{enumerate}
          \item $\forall i \in \{1,...,n\}, x_i' > u_i'$ is impossible because a flow cannot be higher than its
                corresponding capacity. Thus $\forall i \in \{1,...,n\}, x_i' \leq u_i'$.
          \item In the initial configuration of $u_i$ and according to the flow problem setting, a combination of flows
                $y_i$ such that $\forall i \in \{1,...,n\}, y_i = u_i'$ is a valid, albeit not necessarily maximum,
                configuration with a flow $\sum\limits_{i=1}^{n}y_i$. Suppose that $\exists j \in \{1,...,n\} : x_j'
                < u_j'$ as calculated by the maxFlow algorithm with the new direct trusts, $u_i'$. Then for the new
                maxFlow $F'$ it holds that $F' = \sum\limits_{i=1}^{n}x_i' < \sum\limits_{i=1}^{n}y_i$ since $x_j' < y_j$
                which is impossible because the configuration $\forall i \in \{1,...,n\}, x_i' = y_i$ is valid since
                $\forall i \in \{1,...,n\}, y_i = u_i'$ and also has a higher flow, thus the maxFlow algorithm will
                prefer the configuration with the higher flow. Thus we deduce that $\forall i \in \{1,...,n\},
                x_i' \geq u_i'$.
       \end{enumerate}
       From (1) and (2) we conclude that $\forall i \in \{1,...,n\}, x_i' = u_i'$.
    \end{proof}
    \begin{theorem}[Trust flow theorem - TOCHECK] \ \\
    \label{trustflow}
       $Tr_{A \rightarrow B} = MaxFlow_{A \rightarrow B}$ (Treating trusts as capacities)
    \end{theorem}
    \begin{proof} \
        \begin{enumerate}
	   \item We will show that $Tr_{A \rightarrow B} \leq MaxFlow_{A \rightarrow B}$.
           We know that $MaxFlow_{A \rightarrow B} = MinCut_{A \rightarrow B}$. We will show that, if everybody except
           A and B follows the honest strategy,  $Tr_{A \rightarrow B} \leq MinCut_{A \rightarrow B}$. Suppose that in
           round $i$ all the members of the MinCut, $P$, have stolen the maximum value they can from members that belong
           in the MaxFlow graph and nobody in the partition in which $A$ belongs has stolen yet any value. Let the total
           stolen value from the MinCut members be $St$. It is obvious that $St_i \leq MinCut_{A \rightarrow B}$, because
           otherwise there would exist $u \in P$ that doesn't follow the honest strategy, since they stole more than they
           were stolen from. The same argument holds for any round $i' > i$ because in each round an honest player can
           steal only up to the value she has been stolen. It is also impossible that the $St$ increase further due to
           stolen value from members of the partition of $B$ since members of $P$ disconnect the two partitions and have
           already played their turns, thus $\forall i' > i, St_{i'} \leq St_i$. There exists a round, $k$, when all the
           honest players stop stealing, so in the worst case $A$ will have been stolen
           $Tr_{A \rightarrow B} = St_k \leq MinCut_{A \rightarrow B} = MaxFlow_{A \rightarrow B}$.
           \item We can see that $Tr_{A \rightarrow B} \geq MaxFlow_{A \rightarrow B}$ because the strategy where each
           one of the non-idle players steals value equal to the incoming flows from their respective friends is a valid
           strategy that does not contradict with the honest strategy, since for every honest player $w$ it holds that
           $\sum\limits_{v \in N^{-}(w)}x_{vw} = \sum\limits_{v \in N^{+}(w)}x_{wv}$ and according to the strategy each
           honest player will have been stolen value equal to $\sum\limits_{v \in N^{+}(w)}x_{wv}$.
        \end{enumerate}
        Combining the two results, we see that $Tr_{A \rightarrow B} = MaxFlow_{A \rightarrow B}$.
%        OLD PROOF START
%        \begin{enumerate}
%           \item $Tr_{A \rightarrow B} \geq MaxFlow_{A \rightarrow B}$ because by the definition of $Tr_{A \rightarrow B}$,
%           B leaves taking with him all the incoming trust, so there is no trust flowing towards him after leaving.
%           $Tr_{A \rightarrow B} < MaxFlow_{A \rightarrow B}$ would imply that after B left, there would still remain trust
%           flowing from A to B.
%           \item $Tr_{A \rightarrow B} \leq MaxFlow_{A \rightarrow B}$ \\
%           Suppose that $Tr_{A \rightarrow B} > MaxFlow_{A \rightarrow B}$ (1). Then, using the min cut - max flow theorem we
%           see that there is a set of capacities $U= \{u_1,...,u_n\}$ with flows $X = \{x_1,...,x_n\}$ such that
%           $\sum\limits_{i=1}^{n}{x_i} = MaxFlow_{A \rightarrow B}$ and, if severed $(\forall i \in \{1,...,n\} \: u_i' = 0)$
%           the flow from A to B would be $0$, or, put differently, there would be no directed trust path from A to B. No
%           strategy followed by B could reduce the value of A, so our supposition (1) cannot be true.
%        \end{enumerate}
%        OLD PROOF END
    \end{proof}

    \begin{theorem}[Honest world theorem] \ \\
    \label{honestworld}
       If everybody follows the honest strategy, nobody steals any amount from anybody.
    \end{theorem}
    \begin{proof}
       Suppose that there exists a series of stealing actions represented by a vector where $action_i = $"player $i$ steals
       value V $>0$ from player $i+1$". This vector must have an initial element, $action_1$. However, player $1$ follows
       the honest strategy, thus somebody must have stolen from her as well, so player $1$ cannot be the initial element.
       We have a contradiction, thus there cannot exist a series of stealing actions when everybody is honest.
    \end{proof}
    \begin{theorem}[Trust transfer theorem (flow terminology) - TOCHECK] \ \\
    \label{trusttransfer}
       Let $s$ source, $t$ sink, $n = N^{+}(s)$ \\
       $X_s = \{x_{s, 1}, ..., x_{s, n}\}$ outgoing flows from $s$, \\
       $U_s = \{u_{s, 1}, ..., u_{s, n}\}$ outgoing capacities from $s$, \\
       $V$ the value to be transferred. \\
       Nodes apart from $s$, $t$ follow the honest strategy. \\
       Obviously $maxFlow = F = \sum\limits_{i=1}^{n}{x_{s, i}}$.
       {\em \begin{lstlisting}
            /                      ....                     \
           / x_s1/u_s1                         x_1t/u_1t     \
          /                                                   \
         /                                                     \
        / x_s2/u_s2                               x_2t/u_2t     \
       s-------------              ....          ------------t
        \      .                                           .    /
         \     .                                           .   /
          \    .                                           .  /
           \ x_sn/u_sn             ....        x_mt/u_mt     /
            \                                               /
       \end{lstlisting}}
       We create a new graph where
       \begin{enumerate}
         \item  $\sum\limits_{i=1}^{n}{u_{s, i}'} = F - V$
         \item $\forall i \in \{1,...,n\} \: u_{s, i}' \leq x_{s, i}$
       \end{enumerate}
 
       It holds that $maxFlow' = F' = F - V$.
    \end{theorem}
    \begin{proof} \
        From theorem \ref{saturation} we can see that $x_i' = u_i'$. It holds that $F' = \sum\limits_{i=1}^nx_i' =
        \sum\limits_{i=1}^nu_i' = F - V$.
%       \begin{enumerate}
%         \item  It is impossible to have $F' > F - V$ because $F' \leq \sum\limits_{i=1}^{n}{u_{s, i}'} = F - V$.
%         \item  It is impossible to have $F' < F - V$. \\
%         Let $i$ be a node such that $x_{s, i} > 0$ and $I = \{j \in \mathcal{M} : DTr_{i \rightarrow j} > 0\}$
%         the set of members that $i$ directly trusts with a positive value. Let $m = |I|$. In the initial graph
%         we have $x_{s, i} = \sum\limits_{j=1}^{m}{x_{i, j}}, F = \sum\limits_{i=1}^{n}{x_{s, i}}$ and in the new graph
%         we have $x_{s, i}' = u_{s, i}' \leq x_{s, i}, F' = \sum\limits_{i=1}^{n}{x_{s, i}'}, \forall j x_{i, j} \leq
%         u_{i, j} = u_{i, j}'$. We can construct a set $X_i' = \{x_{i, j}'\}$ of flows such that $x_{i, j}' \leq x_{i, j}$
%         and $\sum\limits_{j=1}^{m}{x_{i, j}'} = x_{s, i}'$. This shows that there is a possible flow such that $F' = F - V$,
%         so the maxFlow algorithm will not return a flow less than $F - V$. \\
%         Example construction: \\
%         $\forall j \in \{1,...,k\}, x_{i, j}' = x_{i, j}$ with $k$ such that
%            \begin{enumerate}
%	      \item $\sum\limits_{j=1}^{k}{x_{i, j}} \leq x_{s, i}'$ and
%	      \item $\sum\limits_{j=1}^{k+1}{x_{i, j}} > x_{s, i}'$
%            \end{enumerate}
%         $x_{i, (k+1)}' = x_{s, i}' - \sum\limits_{j=1}^{k}{x_{i, j}'}$ \\
%         $\forall j \in \{k+2,...,|X_i'|\}, x_{i, j}' = 0$
%       \end{enumerate}
    \end{proof}

    \begin{corollary}[Requirement for $\sum\limits_{i=1}^{n}{u_{s, i}'} = F - V$, $u_{s, i}' \leq x_{s, i}$] \ \\
       In the setting of \ref{trusttransfer}, it is impossible to have $maxFlow' = F - V$ if
       $\sum\limits_{i=1}^{n}{u_{s, i}'} > F - V \wedge \forall i \in \{1,...,n\},u_{s, i}' \leq x_{s, i}$.
    \end{corollary}
    \begin{proof}
       Due to \ref{trusttransfer}, $maxFlow' = F - V$ if $\sum\limits_{i=1}^{n}{u_{s, i}'} = F - V
       \wedge \forall i \in \{1,...,n\}, u_{s, i}' \leq x_{s, i}$. If we create new capacities such that
       $\forall i \in \{1,...,n\}, u_{s,i}'' \leq x_{s,i}$, then obviously $maxFlow'' = \sum\limits_{i=1}^{n}{u_{s,i}''}$. If
       additionally $\sum\limits_{i=1}^{n}{u_{s,i}''} > F - V$, then $maxFlow'' > F - V$.
    \end{proof}

    \begin{theorem}[Trust-saving Theorem] \ \\
    \label{trustsave}
       $\forall i \in \{1,...,|N^{+}(A)|\}, u_i' = F_{A_i \rightarrow B} \Leftrightarrow u_i' = u_i$
    \end{theorem}
    \begin{proof}
       We know that $x_i \leq F_{A_i \rightarrow B}$, thus we can see that any increase in $u_i'$ beyond
       $F_{A_i \rightarrow B}$ will not influence $x_i$ and subsequently will not incur any change on the rest of the flows.
    \end{proof}

    \begin{theorem}[Invariable trust reduction with naive algorithms] \ \\
    \label{invariability}
       Let $A$ source, $n = |N^{+}(A)|$ and $u_i'$ new direct trusts. If $\forall i \in \{1,...,n\},u_i' \leq x_i$,
       Trust Reduction $||\delta_i||_1$ is independent of $x_i, u_i' $\newline $\forall$ configurations of $x_i$
    \end{theorem}
    \begin{proof} 
       Since $\forall i \in \{1,...,n\},u_i' \leq x_i$ it is (according to \ref{saturation}) $x_i' = u_i'$, thus $\delta_i = u_i
       - x_i'$. We know that $\sum\limits_{i=1}^{n}x_i' = F - V$, so we have $||\delta_i||_1 = \sum\limits_{i=1}^{n}\delta_i =
       \sum\limits_{i=1}^{n}(u_i - x_i') = \sum\limits_{i=1}^{n}u_i - F + V$ independent of $x_i', u_i'$
    \end{proof}

    \begin{theorem}[Dependence impossibility theorem] \ \\
    \label{independence}
       ${\partial x_j \over \partial x_i} = 0$ with $x_i$ the flow from MaxFlow $\Rightarrow
         \forall x_i' \leq x_i, {\partial x_j \over \partial x_i} = 0$ ceteris paribus
    \end{theorem}
    \begin{proof}
       TODO
    \end{proof}

    Here we show three naive algorithms for calculating new direct trusts so as to maintain invariable risk when paying
    a trusted party. \\
    \begin{algorithm}[H]
       \label{fcfs}
       \SetKwInOut{Input}{Input}
       \SetKwInOut{Output}{Output}
       \Input{$x_i$ flows, $n = |N^{+}(s)|$, $V$ value}
       \Output{$u_i'$ capacities}
       $F \gets \sum\limits_{i=1}^{n}x_i$ \\
       \If{$F < V$}{\Return $\bot$}
       $Fcur \gets F$ \\
       \For{$i \gets 1$ to $n$}
          {$u_i' \gets x_i$} 
       $i \gets 1$ \\
       \While{$Fcur > F - V$}
          {$reduce \gets min(x_i, Fcur - F + V)$ \\
           $Fcur \gets Fcur - reduce$ \\
           $u_i' \gets x_i - reduce$ \\
           $i \gets i + 1$}
       \Return $U' = \bigcup\limits_{i=1}^{n}\{u_i'\}$
       \caption{First-come, first-served trust transfer}
    \end{algorithm}
    \begin{proof}[Proof of correctness for algorithm \ref{fcfs}] \ \\
       We want to prove that $\forall i \in \{1,...,n\} u_i' \leq x_i$ and that $\sum\limits_{i=1}^{n}u_i' = F - V$
       where $F = \sum\limits_{i=1}^{n}x_i$.
       \begin{itemize}
          \item Let $i \in \{1,...,n\}$. In line 6 we can see that $u_i' = x_i$ and the only other occurence of $u_i'$
          is in line 11 where it is never increased $(reduce \geq 0)$, thus we see that, when returned, $u_i' \leq x_i$.
          \item We will show that $\sum\limits_{i=1}^{n}u_i' = F - V$. \\
          $F_{cur,0} = F$ \\
          If $F_{cur,i} = F - V$, then $F_{cur,i+1}$ does not exist because the $while$ loop breaks after calculating
          $F_{cur,i}$. \\
          Else $F_{cur,i+1} = F_{cur,i} - min(x_{i+1}, F_{cur,i} - F + V)$. \\
          If for some $i, min(x_{i+1}, F_{cur,i} - F + V) = F_{cur,i} - F + V$, then $F_{cur,i+1} = F - V$, so if
          $F_{cur,i+1}$ exists, then $\forall k < i, F_{cur,k} = F_{cur,k-1} - x_k \Rightarrow F_{cur,i} =
          F - \sum\limits_{j=1}^{i}x_j$ \\
          Furthermore, if $F_{cur,i+1} = F - V$ then $u_{i+1}' = x_{i+1} - F_{cur,i} + F - V =
          x_i - F + \sum\limits_{j=1}^{i-1}x_j + F - V = \sum\limits_{j=1}^{i}x_j - V$, $\forall k \leq i, u_k' = 0$
          and $\forall k > i+1, u_k' = x_k$. \\
          In total, we have $\sum\limits_{j=1}^{n}u_j' = \sum\limits_{j=1}^{i}x_j - V + \sum\limits_{j=i+1}^{n}x_j =
          \sum\limits_{j=1}^{n}x_j - V \Rightarrow \sum\limits_{j=1}^{n}u_j' = F - V$.
       \end{itemize}
    \end{proof}
    \begin{proof}[Complexity of algorithm \ref{fcfs}] \ \\
    \end{proof}

    \begin{algorithm}[H]
       \SetKwInOut{Input}{Input}
       \SetKwInOut{Output}{Output}
       \Input{$x_i$ flows, $n = |N^{+}(s)|$, $V$ value}
       \Output{$u_i'$ capacities}
       $F \gets \sum\limits_{i=1}^{n}x_i$ \\
       \If{$F < V$}{\Return $\bot$}
       \For{$i \gets 1$ to $n$}
          {$u_i' \gets x_i$}
       $reduce \gets {V \over n}$ \\
       $reduction \gets 0$ \\
       $empty \gets 0$ \\
       $i \gets 0$ \\
       \While{$reduction < V$}
          {\If{$u_i' > 0 \: \wedge \:x_i < reduce$}
                {$empty \gets empty + 1$ \\
                 $reduce = reduce + \frac{x_i - reduce -u_i'}{n - empty}$ \\
                 $reduction \gets reduction + u_i'$ \\
                 $u_i' \gets 0$ \\}
           \ElseIf{$x_i \geq reduce$}{$reduction \gets reduction + u_i' - (x_i - reduce)$ \\
                 $u_i' \gets x_i - reduce$}
           $i \gets (i + 1) mod \:n$}
       \Return $U' = \bigcup\limits_{i=1}^{n}\{u_i'\}$
       \caption{Absolute equality trust transfer($||\Delta_i||_\infty$ minimizer)}
    \end{algorithm}

    \begin{algorithm}[H]
       \SetKwInOut{Input}{Input}
       \SetKwInOut{Output}{Output}
       \Input{$x_i$ flows, $n = |N^{+}(s)|$, $V$ value}
       \Output{$u_i'$ capacities}
       $F \gets \sum\limits_{i=1}^{n}x_i$ \\
       \If{$F < V$}{\Return $\bot$}
       \For{$i \gets 1$ to $n$}
          {$u_i' \gets x_i - \frac{V}{F} x_i$}
       \Return $U' = \bigcup\limits_{i=1}^{n}\{u_i'\}$
       \caption{Proportional equality trust transfer}
    \end{algorithm} \ \\

    \begin{algorithm}[H]
       \SetKwInOut{Input}{Input}
       \SetKwInOut{Output}{Output}
       \SetKwFunction{BinSearch}{BinSearch}
       \Input{$X = \{x_i\}$ flows, $n = |N^{+}(s)|$, $V$ value}
       \Output{$u_i'$ capacities}
       \caption{$||\delta_i||_\infty$ minimizer}
       $F \gets \sum\limits_{i=1}^{n}x_i$ \\
       $\delta \gets \BinSearch{0,V,F,n,X}$ \\
       \For{$i \gets 1$ to $n$}
          {$u_i' \gets max(u_i - \delta, 0)$}
       \Return $U' = \bigcup\limits_{i=1}^{n}\{u_i'\}$
    \end{algorithm}
    \begin{algorithm}[H]
       \SetKwFunction{BinSearch}{BinSearch}
       \SetKwInOut{Input}{Input}
       \SetKwInOut{Output}{Output}
       \Input{$bot$, $top$, $F$, $n$, $X$}
       \Output{$\delta$}
       \If{$bot = top$}{\Return $bot$}
       \Else{
          \For{$i \gets 1$ to $n$}
              {$u_i' \gets u_i - \frac{top + bot}{2}$}       
          \If{$maxFlow < F$}
	     {\Return \BinSearch{$bot$, $\frac{top+bot}{2}$,$n$,$X$,$F$}}
          \Else
	     {\Return \BinSearch{$\frac{top+bot}{2}$, $top$,$n$,$X$,$F$}}
       }
       \caption{BinSearch function}
    \end{algorithm}
    \begin{proof}[Proof of correctness - TOEXPAND]
       In all three algorithms, we have $u_i' <= x_i$ because in the only case where $u_i'$ is altered after its
       initialisation, it is reduced. Furthermore, a total of $V$ is subtracted from all the $u_i'$, thus
       $\sum\limits_{i=1}^{n}u_i' = F - V$.
    \end{proof}

    However, we need to minimize $\sum\limits_{i=1}^{n}(u_i-u_i') = ||\delta_i||_1$.

  \section{Further Research}

  \section{References}

\end{document}
